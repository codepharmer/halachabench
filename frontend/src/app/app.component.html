<div class="page" *ngIf="vm$ | async as vm; else loading">
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1 class="title">HalachaBench</h1>
        <h2 class="subtitle">
          A LiveBench-inspired, contamination-aware benchmark for halacha QA with
          deterministic scoring.
        </h2>
        <p class="hero-note">
          Objective, closed-format questions with explicit source attribution and
          reproducible evaluation.
        </p>
        <p class="hero-subnote">
          Inspired by
          <a href="https://livebench.ai" target="_blank" rel="noopener">
            LiveBench
          </a>
          . Source and artifacts on
          <a
            href="https://github.com/codepharmer/halachabench"
            target="_blank"
            rel="noopener"
          >
            GitHub
          </a>
          .
        </p>
        <div class="hero-links">
          <a class="button" href="#leaderboard">
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <path d="M4 20V10" />
              <path d="M10 20V4" />
              <path d="M16 20v-8" />
              <path d="M22 20H2" />
            </svg>
            Leaderboard
          </a>
          <a class="button" href="#details">
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </svg>
            Details
          </a>
          <a
            class="button"
            href="https://github.com/codepharmer/halachabench"
            target="_blank"
            rel="noopener"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <path d="M8 9l-3 3 3 3" />
              <path d="M16 9l3 3-3 3" />
              <path d="M14 4l-4 16" />
            </svg>
            Code
          </a>
          <a
            class="button"
            [href]="'assets/releases/' + vm.releaseId + '/questions.jsonl'"
            [attr.download]="'questions-' + vm.releaseId + '.jsonl'"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <ellipse cx="12" cy="5" rx="8" ry="3" />
              <path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5" />
              <path d="M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6" />
            </svg>
            Data
          </a>
          <a class="button" href="assets/results.sample.json" download>
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <path d="M14 2v6h6" />
              <path d="M8 13h8" />
              <path d="M8 17h8" />
            </svg>
            Report
          </a>
        </div>
        <div class="hero-meta">
          <div class="meta-item">
            <span>Release</span>
            <strong>{{ vm.releaseId }}</strong>
          </div>
          <div class="meta-item">
            <span>Questions</span>
            <strong>{{ vm.nQuestions }}</strong>
          </div>
          <div class="meta-item">
            <span>Categories</span>
            <strong>{{ vm.categoryCount }}</strong>
          </div>
          <div class="meta-item">
            <span>Missing</span>
            <strong>{{ vm.nMissing }}</strong>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="details">
    <div class="container narrow">
      <h3>Introduction</h3>
      <p>
        HalachaBench focuses on objectively scorable halacha questions. It is
        designed to keep evaluation contamination in check by shipping versioned
        releases, while remaining fully reproducible.
      </p>
      <ul class="bullet-list">
        <li>Deterministic scoring rules with no judge model.</li>
        <li>Closed-format answers with explicit source references.</li>
        <li>Versioned releases to control contamination.</li>
        <li>Public artifacts and reproducible evaluation output.</li>
      </ul>
      <p class="callout">
        Want to evaluate your model on HalachaBench? Open an issue and include
        predictions in the JSONL format.
      </p>
    </div>
  </section>

  <section class="section" id="leaderboard">
    <div class="container">
      <div class="section-header">
        <div>
          <h3>Leaderboard</h3>
          <p>
            We refresh the benchmark on a release cadence to reduce
            contamination. The seed release is
            <strong>{{ vm.releaseId }}</strong>.
          </p>
        </div>
        <div class="overview-card">
          <div class="overview-label">Overall score</div>
          <div class="overview-value">{{ vm.overall | number: '1.3-3' }}</div>
        </div>
      </div>

      <div class="slider-wrap">
        <input
          class="slider"
          type="range"
          [min]="0"
          [max]="releaseDates.length - 1"
          [value]="selectedReleaseIndex"
          (input)="onReleaseChange($event)"
        />
        <div class="slider-bubble" [style.left.%]="sliderPercent">
          {{ releaseDates[selectedReleaseIndex] }}
        </div>
      </div>

      <div class="table-container">
        <table class="leaderboard-table">
          <thead>
            <tr>
              <th>Model</th>
              <th>Overall</th>
              <th *ngFor="let header of vm.categoryHeaders">{{ header }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of vm.leaderboardRows">
              <td class="model-cell">
                <div class="model-name">{{ row.name }}</div>
                <div class="model-sub">{{ row.subtitle }}</div>
              </td>
              <td class="score">{{ row.overall | number: '1.3-3' }}</td>
              <td *ngFor="let header of vm.categoryHeaders">
                {{ row.categoryScores[header] | number: '1.3-3' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h3>Category breakdown</h3>
      <div class="category-grid">
        <div class="category-card" *ngFor="let category of vm.categories">
          <div class="category-header">
            <div>
              <h4>{{ category.name }}</h4>
              <span>{{ category.nTasks }} tasks</span>
            </div>
            <div class="category-score">
              {{ category.score | number: '1.3-3' }}
            </div>
          </div>
          <div class="task-row" *ngFor="let task of category.tasks">
            <span>{{ task.name }}</span>
            <span class="task-score">{{ task.score | number: '1.3-3' }}</span>
            <span class="task-count">n={{ task.nQuestions }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="question-lookup">
    <div class="container narrow">
      <h3>Question lookup</h3>
      <p class="section-lede">
        Search by question id, category, task, or prompt text. Results include a
        prompt preview so you do not need to click through.
      </p>

      <div class="autocomplete">
        <div class="autocomplete-field">
          <input
            id="question-search"
            class="autocomplete-input"
            type="text"
            placeholder="Search questions (type 2+ characters)..."
            [value]="searchQuery"
            autocomplete="off"
            spellcheck="false"
            (input)="onSearchInput($event)"
            (focus)="onSearchFocus()"
            (blur)="onSearchBlur()"
            (keydown)="onSearchKeydown($event)"
          />
          <button
            type="button"
            class="autocomplete-clear"
            *ngIf="searchQuery.length > 0"
            (mousedown)="clearSearch($event)"
          >
            Clear
          </button>
        </div>

        <div class="autocomplete-panel" *ngIf="showAutocomplete" role="listbox">
          <div class="autocomplete-empty" *ngIf="suggestions.length === 0">
            No matches.
          </div>

          <div
            class="autocomplete-item"
            *ngFor="let suggestion of suggestions; let idx = index"
            [class.active]="idx === activeSuggestionIndex"
            (mouseenter)="activeSuggestionIndex = idx"
            (mousedown)="selectSuggestion(suggestion, $event)"
            role="option"
            [attr.aria-selected]="idx === activeSuggestionIndex"
          >
            <div class="autocomplete-item-head">
              <div class="autocomplete-title">{{ suggestion.title }}</div>
              <div class="autocomplete-chips">
                <span class="chip chip-small">{{ suggestion.answerType }}</span>
                <span class="chip chip-small chip-muted">
                  {{ suggestion.category }} / {{ suggestion.task }}
                </span>
              </div>
            </div>

            <div class="autocomplete-id">{{ suggestion.id }}</div>

            <div
              class="autocomplete-body"
              *ngIf="
                suggestion.options.length ||
                suggestion.instruction ||
                suggestion.details.length
              "
            >
              <div
                class="autocomplete-options"
                *ngIf="suggestion.options.length"
              >
                <div
                  class="autocomplete-option"
                  *ngFor="let option of suggestion.options"
                >
                  <span class="option-letter">{{ option.letter }}</span>
                  <span class="option-text">{{ option.text }}</span>
                </div>
              </div>

              <div
                class="autocomplete-instruction"
                *ngIf="suggestion.instruction"
              >
                {{ suggestion.instruction }}
              </div>

              <div
                class="autocomplete-details"
                *ngIf="suggestion.details.length"
              >
                <div
                  class="autocomplete-detail"
                  *ngFor="let line of suggestion.details"
                >
                  {{ line }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h3>Sample questions</h3>
      <div class="question-grid">
        <div class="question-card" *ngFor="let question of vm.sampleQuestions">
          <div class="question-meta">
            {{ question.category }} / {{ question.task }}
          </div>
          <p>{{ question.prompt }}</p>
          <div class="question-footer">
            <span class="chip">{{ question.answerType }}</span>
            <span class="hash">{{ question.id | slice: 0:10 }}...</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="bibtex">
    <div class="container narrow">
      <h3>BibTeX</h3>
      <pre class="bibtex"><code>{{ vm.bibtex }}</code></pre>
    </div>
  </section>

  <footer class="footer">
    <div class="container narrow">
      <p>
        HalachaBench is a benchmark. It does not provide halachic guidance.
        Always consult qualified authorities and primary sources.
      </p>
      <p class="footer-note">
        Forked from LiveBench (livebench.ai). Repository:
        <a
          href="https://github.com/LiveBench/LiveBench"
          target="_blank"
          rel="noopener"
        >
          LiveBench/LiveBench
        </a>
      </p>
    </div>
  </footer>
</div>

<ng-template #loading>
  <div class="page">
    <div class="loading">Loading benchmark assets...</div>
  </div>
</ng-template>
